
<!-- Contenedor Principal del Registro -->
<div class="register-container">

    <!-- Contenedor Principal del Registro -->
    <div class="register-card">
        <h2 class="register-title">Registrarse</h2>

        <!-- Formulario con Template-driven Forms -->
        <form #registerForm="ngForm" (ngSubmit)="onRegister()" novalidate>

            <!-- CAMPO: NOMBRE DEL USUARIO -->
            <div class="form-group">
                <label for="nombre">Nombre</label>
                <div class="input-wrapper">

                    <input 
                        type="text" 
                        id="nombre" 
                        name="nombre" 
                        class="form-input"
                        required 
                        minlength="2"
                        pattern="^[a-zA-ZáéíóúÁÉÍÓÚñÑ\s]+$"
                        [(ngModel)]="user.nombre" 
                        #nombreModel="ngModel" 
                        placeholder="Nombre"
                        [ngClass]="{'invalid-input': nombreModel.invalid && nombreModel.touched,
                                    'valid-input': nombreModel.valid && nombreModel.touched
                        }"
                    />

                    <!-- Íconos de validación -->
                    <span *ngIf="nombreModel.valid && nombreModel.touched" class="check-icon">✔</span>
                    <span *ngIf="nombreModel.invalid && nombreModel.touched" class="error-icon">❌</span>
                </div>

                <!-- Mensajes de error específicos -->
                <div class="error-message" *ngIf="nombreModel.touched && nombreModel.invalid">
                    <span *ngIf="nombreModel.errors?.['required']">Este campo es obligatorio.</span>
                    <span *ngIf="nombreModel.errors?.['minlength']">Debe tener al menos 2 caracteres. </span>
                    <span *ngIf="nombreModel.errors?.['pattern']">Solo se permiten letras.</span>
                </div>
            </div>

            <!-- CAMPO: APELLIDO DEL USUARIO -->
            <div class="form-group">
                <label for="apellido">Apellido</label>
                <div class="input-wrapper">
                    <input type="text" 
                        id="apellido" 
                        name="apellido" 
                        class="form-input"
                        required 
                        minlength="2"
                        pattern="^[a-zA-ZáéíóúÁÉÍÓÚñÑ\s]+$"
                        [(ngModel)]="user.apellido" 
                        #apellidoModel="ngModel" 
                        placeholder="Apellido"
                        [ngClass]="{'invalid-input': apellidoModel.invalid && apellidoModel.touched,
                                    'valid-input': apellidoModel.valid && apellidoModel.touched
                        }">
                        <span *ngIf="apellidoModel.valid && apellidoModel.touched" class="check-icon">✔</span>
                        <span *ngIf="apellidoModel.invalid && apellidoModel.touched" class="error-icon">❌</span>
                </div>
                <div class="error-message" *ngIf="apellidoModel.touched && apellidoModel.invalid">
                    <span *ngIf="apellidoModel.errors?.['required']">Este campo es obligatorio.</span>
                    <span *ngIf="apellidoModel.errors?.['minlength']">Debe tener al menos 2 caracteres. </span>
                    <span *ngIf="apellidoModel.errors?.['pattern']">Solo se permiten letras.</span>
                </div>
            </div>

            <!-- Correo -->
            <div class="form-group">
                <label for="correo">Correo electrónico</label>
                <div class="input-wrapper">
                    <input 
                        type="email" 
                        id="correo" 
                        name="correo" 
                        class="form-input"
                        required email 
                        [(ngModel)]="user.correo" 
                        #correoModel="ngModel" 
                        placeholder="Correo"
                        [ngClass]="{'invalid-input': correoModel.invalid && correoModel.touched,
                            'valid-input': correoModel.valid && correoModel.touched
                        }">
                    <span *ngIf="correoModel.valid && correoModel.touched" class="check-icon">✔</span>
                    <span *ngIf="correoModel.invalid && correoModel.touched" class="error-icon">❌</span>
                </div>
                <div class="error-message" *ngIf="correoModel.touched && correoModel.invalid">
                    <span *ngIf="correoModel.errors?.['required']">Este campo es obligatorio.</span>
                    <span *ngIf="correoModel.errors?.['email']">Debe ser un correo válido.</span>
                </div>
            </div>

            <!-- Usuario -->
            <div class="form-group">
                <label for="usuario">Nombre de usuario</label>
                <div class="input-wrapper">
                    <input 
                        type="text" 
                        id="usuario" 
                        name="usuario" 
                        class="form-input"
                        required 
                        minlength="3" 
                        [(ngModel)]="user.usuario" 
                        #usuarioModel="ngModel" 
                        placeholder="Usuario"
                        [ngClass]="{'invalid-input': usuarioModel.invalid && usuarioModel.touched, 
                            'valid-input': usuarioModel.valid && usuarioModel.touched
                        }">
                    <span *ngIf="usuarioModel.valid && usuarioModel.touched" class="check-icon">✔</span>
                    <span *ngIf="usuarioModel.invalid && usuarioModel.touched" class="error-icon">❌</span>
                </div>
                <div class="error-message" *ngIf="usuarioModel.touched && usuarioModel.invalid">
                    <span *ngIf="usuarioModel.errors?.['required']">Este campo es obligatorio.</span>
                    <span *ngIf="usuarioModel.errors?.['minlength']">Debe tener al menos 3 caracteres.</span>
                </div>
            </div>

            <!-- Contraseña -->
            <div class="form-group">
                <label for="password">Contraseña</label>
                <div class="input-wrapper">

                    <input type="password" 
                        id="password" 
                        name="password" 
                        class="form-input"
                        required 
                        minlength="8" 
                        pattern="^(?=.*[A-Z])(?=.*\d).{8,}$"
                        [(ngModel)]="user.password"
                        #passwordModel="ngModel" 
                        placeholder="Contraseña"
                        [ngClass]="{'invalid-input': passwordModel.invalid && passwordModel.touched,
                            'valid-input': passwordModel.valid && passwordModel.touched
                        }">
                        <span *ngIf="passwordModel.valid && passwordModel.touched" class="check-icon">✔</span>
                        <span *ngIf="passwordModel.invalid && passwordModel.touched" class="error-icon">❌</span>
                </div>
                <small class="password-criteria">Mínimo 8 caracteres, una mayúscula y un número.</small>
                <div class="error-message" *ngIf="passwordModel.touched && passwordModel.invalid">
                    <span *ngIf="passwordModel.errors?.['required']">Este campo es obligatorio.</span>
                    <span *ngIf="passwordModel.errors?.['pattern']">Formato inválido.</span>
                </div>
            </div>

            <!-- Repetir Contraseña -->
            <div class="form-group">
                <label for="confirmPassword">Repetir contraseña</label>
                <div class="input-wrapper">
                    <input 
                        type="password" 
                        id="confirmPassword" 
                        name="confirmPassword" 
                        class="form-input"
                        required 
                        [(ngModel)]="confirmPassword" 
                        #confirmPasswordModel="ngModel" 
                        placeholder="Repetir contraseña"
                        [ngClass]="{'invalid-input': confirmPasswordModel.touched && (confirmPasswordModel.invalid || user.password !== confirmPassword),
                            'valid-input': confirmPasswordModel.valid && user.password === confirmPassword && confirmPasswordModel.touched
                        }">
                    <span *ngIf="confirmPasswordModel.valid && confirmPasswordModel.touched && passwordsCoinciden()" class="check-icon">✔</span>
                    <span *ngIf="(!confirmPasswordModel.valid || !passwordsCoinciden()) && confirmPasswordModel.touched" class="error-icon">❌</span>
                </div>
                <div class="error-message" *ngIf="confirmPasswordModel.touched && !passwordsCoinciden()">
                    Las contraseñas no coinciden.
                </div>
            </div>

            <!-- Fecha de nacimiento -->
            <div class="form-group">
                <label for="fechaNacimiento">Fecha de nacimiento</label>
                <div class="input-wrapper"> 
                    <input 
                        type="date" 
                        id="fechaNacimiento" 
                        name="fechaNacimiento" 
                        class="form-input"
                        required 
                        [(ngModel)]="user.fechaNacimiento" 
                        #fechaNacimientoModel="ngModel" 
                        placeholder="Fecha de nacimiento"
                        [ngClass]="{'invalid-input': (fechaNacimientoModel.touched && (fechaNacimientoModel.invalid || !esFechaValida())),
                                    'valid-input': (fechaNacimientoModel.valid && esFechaValida() && fechaNacimientoModel.touched)
                        }">
                    <span *ngIf="fechaNacimientoModel.valid && fechaNacimientoModel.touched && esFechaValida()" class="check-icon">✔</span>
                    <span *ngIf="fechaNacimientoModel.touched && (!fechaNacimientoModel.valid || !esFechaValida())" class="error-icon">❌</span>
                </div>
                <div class="error-message" *ngIf="fechaNacimientoModel.touched && fechaNacimientoModel.invalid">
                    Este campo es obligatorio.
                </div>
            </div>
            <div class="error-message" *ngIf="fechaNacimientoModel.touched && !esFechaValida()">
                Debe tener al menos 13 años cumplidos.
            </div>

            <!-- Descripción -->
            <div class="form-group">
                <label for="descripcion">Descripción breve</label>
                <div class="input-wrapper">
                    <textarea 
                        id="descripcion" 
                        name="descripcion" 
                        class="form-input"
                        required 
                        minlength="10" 
                        rows="3" 
                        [(ngModel)]="user.descripcion" #descripcionModel="ngModel" placeholder="Descripción"
                        [ngClass]="{'invalid-input': descripcionModel.invalid && descripcionModel.touched,
                            'valid-input': descripcionModel.valid && descripcionModel.touched
                        }">
                    </textarea>
                    <span *ngIf="descripcionModel.valid && descripcionModel.touched" class="check-icon">✔</span>
                    <span *ngIf="descripcionModel.invalid && descripcionModel.touched" class="error-icon">❌</span>
                </div>
                <div class="error-message" *ngIf="descripcionModel.touched && descripcionModel.invalid">
                    <span *ngIf="descripcionModel.errors?.['required']">Este campo es obligatorio.</span>
                    <span *ngIf="descripcionModel.errors?.['minlength']">Debe tener al menos 10 caracteres.</span>
                </div>
            </div>

            <!-- Imagen de perfil -->
            <div class="form-group">
                <label for="imagenPerfil">Imagen de perfil</label>
                <input type="file" id="imagenPerfil" name="imagenPerfil" class="form-input"
                    accept="image/*" (change)="onFileSelected($event)">
                    
            </div>

            

            <!-- Perfil -->
            <!-- <div class="form-group">
                <label for="perfil">Perfil</label>
                <select id="perfil" name="perfil" class="form-input"
                        [(ngModel)]="user.perfil" required>
                <option value="usuario">Usuario</option>
                <option value="administrador">Administrador</option>
                </select>
            </div> -->

            <!-- Spinner en botón -->
            <div class="form-group">
                <button type="submit" class="register-button" [disabled]="registerForm.invalid || loading">
                    <span *ngIf="loading" class="spinner"></span>
                    {{ loading ? 'Registrando...' : 'Registrarse' }}
                </button>
            </div>

        </form>

        <!-- Link a Login -->
        <div class="login-link">
            <p>
                ¿Ya tienes cuenta?
                <a routerLink="/login" routerLinkActive="active-link">Iniciar Sesion</a>
            </p>
        </div>
    </div>
</div>